\section{Prototype Implementation}
\label{sec:prototype}

Our prototype implementation is available for Linux on NVIDIA Fermi GPUs.
It is fully open-source, and does not depend on proprietary software
except for compilers.
Our GPU device driver implementation is based on what we have been
developing in collaboration with PathScale Corporation~\cite{ENZO}.
The OS runtime and the CUDA Driver API library are newly designed and
implemented.
Our prototype implementation is still partly experimental, but we
believe that it is useful to facilitate future research on GPU
resource management, given that such open-source software for GPUs has
not appeared yet.

\textbf{Interface:}
Gdev is a Linux kernel module (a character device driver) composing the
device driver and runtime library.
The device driver manages low-level hardware resources to operate the
GPU, such as GPU channels, memory-mapped I/O registers, page tables,
firmware, and voltage and frequency.
It exposes a set of \texttt{ioctl} commands so that a traditional
user-space runtime library can still be used on top of Gdev without 
first-class GPU resource management.
The runtime library, on the other hand, manages GPU commands and API
function calls.
It also coordinates with the Gdev memory manager and scheduler for
first-class GPU resource management, and uses
the device-driver raw functions to access hardware resources.
The Gdev API is implemented in the runtime library, and its function
symbols are exported from the kernel module so that other OS modules can
call them.
These API functions are also one-to-one mapped to Gdev \texttt{ioctl}
commands so that user-space programs can run under Gdev's first-class
GPU resource management.

We use \texttt{/proc} filesystem in Linux to configure Gdev.
For example, the number of virtual GPUs and their maps to physical GPUs
are visible to users through \texttt{/proc}.
The compute and memory bandwidth and memory share for each virtual GPU
are also configurable at runtime through \texttt{/proc}.
We plan to integrate the configuration of priority and reserve for
each single task into \texttt{/proc} based on a TimeGraph
approach~\cite{Kato_ATC11} in future work.

\textbf{Resource Parameters:}
The performance of Gdev is affected by resource parameters, such as the
page size for virtual memory, period for virtual GPU credits, chunk size
for memory-copy, and boundary between I/O access and DMA.
We use 4KB of page size as Linux uses this size by default for host
memoroy management.
We also respect Xen's default setup for the period of virtual GPU
credits, \textit{i.e.}, we set it 30ms.
The remaining parameters are pretty GPU-specific.
They are determined through experiments as demonstrated in
Section~\ref{sec:evaluation}.

\textbf{Portability:}
Our implementation is still aligned with Direct Rendering Infrastracture
(DRI)~\cite{DRI}, a Linux framework for graphics rendering with the GPU.
Prior work on GPU scheduling, such as TimeGraph~\cite{Kato_ATC11} and
GERM~\cite{Bautin_MCNC08}, are also based on DRI.
Therefore, a part of Gdev functionality, such as virtual GPUs and shared
memory, could be used with these previous solutions for 3-D graphics
applications.
Our implementation is also portable for other device drivers and GPU
architectures, since driver/architecture-dependent functions are cleanly
separated from resource management functions.
In fact, we plan to port Gdev for AMD and Intel GPUs as well as other
NVIDIA GPUs.
